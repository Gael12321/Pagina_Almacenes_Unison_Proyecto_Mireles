<!-- templates/tu_template.html -->
{% extends "index.html" %}
{% load static %}

{% block content %}
    {% if reportes %}
    {% if user.is_authenticated and user.rol == 'Intendente' %}
        {% with reporte=reportes.0 %} {# Tomar el primer reporte para obtener el usuario #}
            <h2>Lista de reportes de {{ reporte.solicitante.username }}</h2>
        {% endwith %}
        {% else %}
        <h2>Lista de reportes</h2>
        {% endif %}   
        {% for reporte in reportes %}
            <hr>
            <p><b>Solicitud: </b>{{ reporte }}</p>
            <p><b>Reporte: </b>{{ reporte.pk }}</p>
            <p><b>Fecha:</b> {{ reporte.fecha}}</p>
            
            <!-- Iterar sobre los DetalleReporte asociados a este Reporte -->
            {% for detalle in reporte.detallereporte_set.all %}
                <p>
                    Producto: {{ detalle.producto.nombre_articulo }} - Cantidad: {{ detalle.cantidad }} - 
                    Total Gastado: {{ detalle.total_gastado|floatformat:2 }}
                </p>
            {% endfor %}

            <!-- Mostrar el total gastado por reporte -->
            <p>Total Gastado : {{ reporte.total_gastado|floatformat:2 }}</p>
                   
            {% if user.is_authenticated and user.rol == 'Admin' %}
            <!-- Agregar un enlace al detalle del usuario -->
            <p><b>Solicitante: </b><a href="{% url 'Reporte_Usuario' pk=reporte.solicitante.pk %}">{{ reporte.solicitante.username }}</a></p>
            {% endif %} 
            
            <hr>
        {% endfor %}
        
        {% if user.is_authenticated and user.rol == 'Admin' %}
        <a href="{% url 'borrar_todos_reportes' %}">Eliminar todos los reportes</a>
        {% endif %}
    {% else %}
        <p>No hay solicitudes a√∫n.</p>
    {% endif %}
    <a href="{% url 'portal_admin' %}" class="btn btn-info">Volver al portal</a>
    <br>
{% endblock %}
